# テーマ構成・デザイン仕様書

## 1. デザインコンセプト
*   **ターゲット**: ポッドキャストリスナー
*   **スタイル**: SNS風カード型UI（GeneratePressベース）
*   **特徴**:
    *   コンテンツを「カード」として視覚的に独立させる。
    *   画像を効果的に配置し、視認性を高める。
    *   ポッドキャスト再生への導線を短縮する。

## 2. 技術スタック
*   **親テーマ**: [GeneratePress](https://wordpress.org/themes/generatepress/)
*   **子テーマ**: `generatepress-child`
    *   カスタマイズは基本的に子テーマに対して行う。
*   **CSS/JS**: 子テーマ内の `style.css` および `functions.php` で管理。
*   **ポッドキャストプラグイン**: Seriously Simple Podcasting (想定)

## 3. レイアウト仕様 (確定)

### 3.1 投稿一覧 (アーカイブページ)
Twitter (X) 風の「縦スクロール・タイムライン」をベースにしつつ、PCでは CSS Grid を用いた独自の2カラム構成を採用。

*   **PCレイアウト構成**:
    *   **コンテナ**: CSS Grid による2カラム (`minmax(0, 1fr) 300px`)。
    *   **メインエリア (左側・1fr)**:
        *   カード型リストを表示。
        *   **無限スクロール**: jQuery.get を用いた簡易実装済み。開発環境(CORS)対策として相対パス変換処理を含む。
    *   **サイドエリア (右側・300px固定)**:
        *   Hook: `generate_after_primary_content_area` を使用して注入。
        *   **要素**:
            1.  **高機能プレイヤー (Sticky)**: `position: sticky` で画面上部に固定。
            2.  **広告枠**: プレイヤーの下に**1枠**配置（Fix固定）。
        *   **連動動作**:
            *   「スマートヘッダー」の動きに連動して、サイドバーの `top` 位置が自動調整されるJS実装済み。
        *   **DOM制御**: GeneratePress標準のサイドバー（ウィジェットエリア）はフックでHTML生成ごと無効化済み。

### 3.2 ヘッダー・フッター仕様 (New)
*   **スマートヘッダー**:
    *   `position: fixed` で常時上部に配置。
    *   **下スクロール**: アニメーションして画面外へ隠れる。
    *   **上スクロール**: 即座に再表示される。
    *   右サイドバー（プレイヤー）もこの動きに合わせて上下にスライドし、重なりを防ぐ。

*   **フッター**:
    *   GeneratePress標準のクレジット表記 (`Built with ...`) は非表示。
    *   シンプルなコピーライト (`© Year SiteName`) のみを表示。

*   **カード内の要素 (タイムライン)**:
    1.  **タイトル**: 記事タイトル。
    2.  **投稿日時**: メタ情報。
    3.  **再生ボタン (Play Episode)**:
        *   フック `generate_after_entry_header` でタイトルの下に挿入済み。
        *   クリックすると、右側の「固定プレイヤー」で再生が開始される（JS制御）。
        *   再生中は「Pause」表示に切り替わる。

## 4. UI/UXデザイン仕様

### 4.1 テーマ切り替え (Dark/Light Mode)
ユーザーの環境設定および手動操作によるテーマ切り替えを実装。

*   **切り替えスイッチ**:
    *   ヘッダーメニュー内の「サンプルページ」項目の位置に、SVGアイコン（☀️/🌙）ボタンを配置。
    *   `localStorage` に設定を保存 (`theme: 'dark' | 'light'`)。
*   **配色設計**:
    *   **Light Theme**:
        *   Background: `#ffffff`
        *   Text: `#333333`, `#666666`
        *   Accent: **Twitter Blue** (`#1da1f2`)
        *   Card Style: 白抜き、ドロップシャドウ付き。
    *   **Dark Theme**:
        *   Background: `#121212` (Body), `#1e1e1e` (Components)
        *   Text: `#e0e0e0`, `#aaaaaa`
        *   Accent: **Orange** (`#ff6600`) - 黒背景での視認性と暖かみを重視。
        *   Card Style: 明度操作によるレイヤー表現（シャドウ＋ボーダー）。

### 4.2 アイコン・ビジュアル
*   **SVG採用**: FontAwesome等の外部フォントに依存せず、インラインSVGを使用して軽量化・レスポンシブ化。
    *   Play/Pause, Volume/Mute, Speed, Download。
    *   Theme Toggle (Sun/Moon)。
*   **Wave Animation**:
    *   再生中の記事ボタン内に、CSS Keyframes (`@keyframes wave`) を用いた4本のバーが動くオーディオスペクトラム風アニメーションを表示。
    *   JSによるDOM注入 (`div.wave-bar`) で制御。

### 4.3 プレイヤー詳細仕様
*   **機能ボタン**:
    *   **Rewind/Forward**: -15秒 / +30秒 の固定スキップ。
    *   **Speed**: 1.0x, 1.25x, 1.5x, 2.0x のループ切り替え。
    *   **Volume**: スライダー + ミュート切り替えボタン。
    *   **Download**: 音源ロード完了時のみ `disabled` が解除される安全設計。
*   **状態管理**:
    *   非同期(`Promise`)による再生処理のエラーハンドリング（連打時の `AbortError` 対策）。
    *   グローバルロックフラグではなく、イベントリスナーの重複登録解除 (`.off().on()`) による多重発火防止を採用。

## 5. 課題と今後の展望
*   **モバイル対応の高度化**: 現在、プレイヤーは `hide-on-mobile` で非表示にしているため、モバイル用の追従プレイヤー（下部固定バーなど）の実装が必要。
*   **SPA遷移**: ページ遷移時にオーディオが途切れる問題は未解決。将来的にはBarba.js導入等のSPA化を検討。

```

## 5. 開発プロセス
GeneratePress **無料版** の機能をベースに、子テーマでの開発を行う。

1.  子テーマ (`generatepress-child`) の作成と有効化。
2.  **右サイドバーレイアウトの構築**:
    *   GeneratePressのデフォルト2カラム設定を利用しつつ、CSS Flexbox/Gridで左寄せと固定配置を調整する。
3.  **テンプレートカスタマイズ**:
    *   記事ループ内に「日本語/英語」2つのボタンを出力するロジックを実装（カスタムフィールド等を利用）。
4.  **JavaScriptプレイヤー実装**:
    *   右側の固定プレイヤーと、各カードのボタンを連動させるJS制御を実装。
    *   無限スクロールライブラリ (例: Infinite Scroll) の導入。
